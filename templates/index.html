<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDI-SCAN.AI | AI Dermatology</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #050505;
            --card-bg: rgba(20, 20, 25, 0.7);
            --accent-cyan: #00f2ff;
            --text-main: #ffffff;
            --text-muted: #8b9bb4;
            --border-color: rgba(255, 255, 255, 0.1);
            --success: #00ff9d;
            --danger: #ff0055;
        }

        /* Essential for full-screen footer layout */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 20%, rgba(68, 0, 139, 0.4) 0%, transparent 40%),
                              radial-gradient(circle at 90% 80%, rgba(0, 200, 255, 0.15) 0%, transparent 40%);
            color: var(--text-main);
            display: flex;
            flex-direction: column; /* Stack main content and footer */
            overflow-x: hidden;
        }

        /* Main content grows to push footer down */
        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .main-wrapper {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            transition: all 0.6s ease;
        }

        /* --- Analysis Card --- */
        .glass-card {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 35px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo { font-family: 'Exo 2', sans-serif; font-size: 22px; font-weight: 700; color: var(--accent-cyan); }

        .upload-zone { border: 2px dashed var(--accent-cyan); background: rgba(0, 242, 255, 0.03); border-radius: 16px; padding: 40px 20px; text-align: center; cursor: pointer; }

        .btn { background: linear-gradient(90deg, var(--accent-cyan), #00aaff); border: none; color: #000; font-weight: 700; padding: 14px; border-radius: 12px; width: 100%; cursor: pointer; margin-top: 15px; text-transform: uppercase; }
        .btn:disabled { background: #333; color: #666; cursor: not-allowed; }

        #results-view { display: none; text-align: center; }
        .preview-img { width: 90px; height: 90px; object-fit: cover; border-radius: 50%; border: 2px solid var(--accent-cyan); margin: 0 auto 15px; }
        .prediction-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; }
        
        .stat-row { margin-bottom: 12px; text-align: left; }
        .stat-header { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; }
        .progress-track { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 1s ease; }

        /* --- CHATBOT SECTION --- */
        #chat-section {
            display: none;
            width: 100%;
            max-width: 450px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--accent-cyan);
            border-radius: 24px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 242, 255, 0.1);
            animation: fadeIn 0.6s ease forwards;
        }

        .chat-box { height: 250px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; margin-bottom: 15px; font-size: 14px; }
        .bot-msg { color: var(--accent-cyan); margin-bottom: 10px; }
        .user-msg { color: #fff; text-align: right; margin-bottom: 10px; }

        .input-wrapper { position: relative; display: flex; gap: 10px; }
        #chat-input { flex: 1; background: rgba(0,0,0,0.5); border: 1px solid var(--border-color); color: white; padding: 12px; border-radius: 10px; outline: none; }
        
        #suggestions-area {
            position: absolute; bottom: 55px; left: 0; width: 100%;
            background: #111116; border-radius: 10px; border: 1px solid var(--accent-cyan);
            display: none; flex-direction: column; max-height: 180px; overflow-y: auto; z-index: 100;
        }
        .sug-btn { background: none; border: none; color: var(--accent-cyan); padding: 12px; text-align: left; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* --- FULL SCREEN FOOTER --- */
        footer {
            width: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--border-color);
            padding: 40px 0 20px 0;
            color: var(--text-muted);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 40px;
        }

        .footer-brand { font-family: 'Exo 2', sans-serif; font-size: 20px; color: var(--accent-cyan); font-weight: 700; margin-bottom: 15px; display: block; }
        .footer-text { font-size: 13px; line-height: 1.6; }
        .footer-header { color: #fff; font-weight: 600; font-size: 14px; margin-bottom: 15px; display: block; }
        .footer-links { list-style: none; padding: 0; margin: 0; }
        .footer-links li { margin-bottom: 8px; font-size: 13px; }
        .footer-links a { color: var(--text-muted); text-decoration: none; transition: 0.3s; }
        .footer-links a:hover { color: var(--accent-cyan); }

        .footer-bottom {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.05);
            font-size: 11px;
            letter-spacing: 2px;
        }

        /* Mobile Adaptations */
        @media (max-width: 900px) {
            main { padding: 20px 10px; }
            .main-wrapper { flex-direction: column; align-items: center; }
            .footer-content { grid-template-columns: 1fr; text-align: center; }
        }

        .typing::after { content: '...'; animation: blink 1s infinite; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <main>
        <div class="main-wrapper" id="layout-wrapper">
            <div class="glass-card">
                <div id="scanner" style="position:absolute; top:0; left:0; width:100%; height:2px; background:var(--accent-cyan); animation:scan 2s infinite linear; display:none;"></div>
                <div class="header">
                    <span class="logo"><i class="fa-solid fa-dna"></i> MEDI-SCAN.AI</span>
                </div>

                <div id="upload-view">
                    <select id="model-select" style="width:100%; background:black; border:1px solid var(--border-color); color:white; padding:12px; border-radius:10px; margin-bottom:20px;">
                        <option value="tflite">TFLite Neural Engine</option>
                        <option value="mobilenetv2">MobileNetV2 Vision</option>
                        <option value="b3">EfficientNet B3 High-Res</option>
                    </select>
                    <div class="upload-zone" onclick="document.getElementById('file-input').click()">
                        <i class="fa-solid fa-atom" style="font-size:35px; color:var(--accent-cyan); margin-bottom:10px;"></i>
                        <div id="upload-text">Initialize Scan Sequence</div>
                        <input type="file" id="file-input" hidden accept="image/*">
                    </div>
                    <button class="btn" id="submit-btn" disabled onclick="startAnalysis()">Begin Analysis</button>
                </div>

                <div id="results-view">
                    <img id="result-img-preview" class="preview-img">
                    <div class="prediction-title" id="pred-title">RESULT</div>
                    <div id="stats-container"></div>
                    <button class="btn" style="background:none; border:1px solid var(--accent-cyan); color:var(--accent-cyan);" onclick="location.reload()">Reset Matrix</button>
                </div>
            </div>

            <div id="chat-section">
                <div style="font-size: 11px; color: var(--accent-cyan); font-weight: 700; margin-bottom: 15px; letter-spacing: 1px;">CORE_ASSISTANT_V2</div>
                <div class="chat-box" id="chat-box"></div>
                <div class="input-wrapper">
                    <div id="suggestions-area"></div>
                    <input type="text" id="chat-input" placeholder="Query the AI..." autocomplete="off">
                    <button onclick="handleSend()" style="background:var(--accent-cyan); border:none; border-radius:10px; width:45px; cursor:pointer;"><i class="fa-solid fa-bolt"></i></button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <span class="footer-brand">MEDI-SCAN.AI</span>
                <p class="footer-text">
                    Leveraging state-of-the-art computer vision to provide instant insights into skin health. 
                    Our mission is to bridge the gap between technology and dermatological awareness.
                </p>
            </div>
            <div class="footer-section">
                <span class="footer-header">Platform</span>
                <ul class="footer-links">
                    <li><a href="#">Neural Models</a></li>
                    <li><a href="#">API Documentation</a></li>
                    <li><a href="#">Security Protocol</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <span class="footer-header">Resources</span>
                <ul class="footer-links">
                    <li><a href="#">DermNet Guide</a></li>
                    <li><a href="#">Skin Cancer Org</a></li>
                    <li><a href="#">Contact Support</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2026 CYBERNETIC MEDICAL SYSTEMS. ALL RIGHTS RESERVED. [NOT A REPLACEMENT FOR MEDICAL ADVICE]
        </div>
    </footer>

    <script>
        // ... (All the JavaScript from the previous response remains the same) ...
        const fileInput = document.getElementById('file-input');
        const submitBtn = document.getElementById('submit-btn');
        const chatInput = document.getElementById('chat-input');
        const sugArea = document.getElementById('suggestions-area');
        let allQuestions = [];

        fileInput.onchange = () => { if (fileInput.files[0]) { document.getElementById('upload-text').innerText = fileInput.files[0].name; submitBtn.disabled = false; } };

        async function startAnalysis() {
            document.getElementById('scanner').style.display = 'block';
            submitBtn.disabled = true;
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('model', document.getElementById('model-select').value);
            const res = await fetch('/predict', { method: 'POST', body: formData });
            const data = await res.json();
            showResults(data, fileInput.files[0]);
        }

        function showResults(data, file) {
            document.getElementById('scanner').style.display = 'none';
            document.getElementById('upload-view').style.display = 'none';
            document.getElementById('results-view').style.display = 'block';
            if(window.innerWidth > 900) document.getElementById('layout-wrapper').style.justifyContent = "flex-start";
            document.getElementById('chat-section').style.display = 'block';
            const reader = new FileReader();
            reader.onload = (e) => document.getElementById('result-img-preview').src = e.target.result;
            reader.readAsDataURL(file);
            const title = document.getElementById('pred-title');
            title.innerText = data.prediction.toUpperCase();
            title.style.color = data.prediction === 'malignant' ? '#ff0055' : '#00ff9d';
            const container = document.getElementById('stats-container');
            container.innerHTML = '';
            Object.entries(data.probabilities).forEach(([label, score]) => {
                const pct = (score * 100).toFixed(1);
                container.innerHTML += `<div class="stat-row"><div class="stat-header"><span>${label.toUpperCase()}</span><span>${pct}%</span></div><div class="progress-track"><div class="progress-fill" style="width:${pct}%; background:${label === 'malignant' ? '#ff0055' : '#00ff9d'}"></div></div></div>`;
            });
            typeBotMessage("Sequence complete. I have identified " + data.prediction + " structures. How shall we proceed?");
            fetchSuggestions();
        }

        async function fetchSuggestions() {
            const res = await fetch('/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({message: ""}) });
            const data = await res.json();
            allQuestions = data.suggestions;
        }

        chatInput.oninput = () => {
            const val = chatInput.value.toLowerCase();
            sugArea.innerHTML = '';
            if (!val) { sugArea.style.display = 'none'; return; }
            const filtered = allQuestions.filter(q => q.toLowerCase().includes(val));
            if (filtered.length > 0) {
                sugArea.style.display = 'flex';
                filtered.forEach(q => {
                    const b = document.createElement('button');
                    b.className = 'sug-btn'; b.innerText = q;
                    b.onclick = () => { chatInput.value = q; sugArea.style.display = 'none'; handleSend(); };
                    sugArea.appendChild(b);
                });
            } else { sugArea.style.display = 'none'; }
        };

        function handleSend() {
            const msg = chatInput.value; if(!msg) return;
            document.getElementById('chat-box').innerHTML += `<div class="chat-msg user-msg"><b>USER:</b> ${msg}</div>`;
            chatInput.value = ''; sugArea.style.display = 'none';
            getReply(msg);
        }

        async function getReply(msg) {
            const res = await fetch('/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({message: msg}) });
            const data = await res.json();
            typeBotMessage(data.reply);
        }

        function typeBotMessage(text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-msg bot-msg typing';
            msgDiv.innerHTML = "<b>AI:</b> ";
            document.getElementById('chat-box').appendChild(msgDiv);
            let i = 0;
            const interval = setInterval(() => {
                if (i < text.length) { msgDiv.innerHTML += text.charAt(i); i++; }
                else { clearInterval(interval); msgDiv.classList.remove('typing'); }
                document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
            }, 25);
        }
    </script>
</body>
</html>